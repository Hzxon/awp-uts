<%- include('../partials/header', {title: 'Master Siswa'}) %>

<div class="flex h-screen bg-gray-100">
    <%- include('../partials/sidebar', {user: user, active: 'master-siswa'}) %>
    
    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <%- include('../partials/topbar', {user: user, pageTitle: 'Master Siswa'}) %>

        <main class="flex-1 p-6 overflow-y-auto">
            <div class="bg-white p-6 rounded-xl shadow-md">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Data Master Siswa</h2>
                    <button onclick="openModal('add-student-modal')" class="flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">
                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Tambah Siswa
                    </button>
                </div>
                <!-- Tabel Data Siswa -->
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3">ID</th>
                                <th scope="col" class="px-6 py-3">Nama Lengkap</th>
                                <th scope="col" class="px-6 py-3">Kelas</th>
                                <th scope="col" class="px-6 py-3">Email</th>
                                <th scope="col" class="px-6 py-3 text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% students.forEach(student => { %>
                            <tr class="bg-white border-b">
                                <td class="px-6 py-4"><%= student.id %></td>
                                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap"><%= student.name %></th>
                                <td class="px-6 py-4"><%= student.class %></td>
                                <td class="px-6 py-4"><%= student.email %></td>
                                <td class="px-6 py-4 text-center space-x-2">
                                    <button onclick="openEditModal('<%= JSON.stringify(student) %>')" class="text-blue-600 hover:text-blue-800"><i data-lucide="edit"></i></button>
                                    <button onclick="openDeleteModal('<%= student.id %>')" class="text-red-600 hover:text-red-800"><i data-lucide="trash-2"></i></button>
                                </td>
                            </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Modals -->
<!-- Modal Tambah -->
<div id="add-student-modal" class="modal-backdrop fixed inset-0 z-50 flex items-center justify-center hidden">
    <div class="bg-white w-full max-w-lg p-6 rounded-xl shadow-2xl">
        <h3 class="text-lg font-semibold">Tambah Siswa Baru</h3>
        <form action="/master-siswa/add" method="POST" class="mt-4 space-y-4">
            <div>
                <label class="block text-sm">Nama Lengkap</label>
                <input type="text" name="name" class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2" required>
            </div>
            <div>
                <label class="block text-sm">Kelas</label>
                <input type="text" name="class" class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2" required>
            </div>
            <div>
                <label class="block text-sm">Email</label>
                <input type="email" name="email" class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2" required>
            </div>
            <div class="pt-4 flex justify-end space-x-3">
                <button type="button" onclick="closeModal('add-student-modal')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg">Batal</button>
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Simpan</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Edit -->
<div id="edit-student-modal" class="modal-backdrop fixed inset-0 z-50 flex items-center justify-center hidden">
    <div class="bg-white w-full max-w-lg p-6 rounded-xl shadow-2xl">
        <h3 class="text-lg font-semibold">Edit Data Siswa</h3>
        <form id="edit-form" action="" method="POST" class="mt-4 space-y-4">
            <input type="hidden" name="id" id="edit-student-id">
            <div>
                <label class="block text-sm">Nama Lengkap</label>
                <input type="text" name="name" id="edit-student-name" class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2" required>
            </div>
            <div>
                <label class="block text-sm">Kelas</label>
                <input type="text" name="class" id="edit-student-class" class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2" required>
            </div>
            <div>
                <label class="block text-sm">Email</label>
                <input type="email" name="email" id="edit-student-email" class="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2" required>
            </div>
            <div class="pt-4 flex justify-end space-x-3">
                <button type="button" onclick="closeModal('edit-student-modal')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg">Batal</button>
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Update</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Delete -->
<div id="delete-confirmation-modal" class="modal-backdrop fixed inset-0 z-50 flex items-center justify-center hidden">
    <div class="bg-white w-full max-w-md p-6 rounded-xl shadow-2xl text-center">
        <i data-lucide="alert-triangle" class="h-12 w-12 text-red-500 mx-auto"></i>
        <h3 class="text-lg font-medium text-gray-900 mt-5">Hapus Data Siswa</h3>
        <p class="text-sm text-gray-500 mt-2">Apakah Anda yakin? Tindakan ini tidak dapat dibatalkan.</p>
        <form id="delete-form" action="" method="POST" class="mt-6 flex justify-center space-x-3">
            <button type="button" onclick="closeModal('delete-confirmation-modal')" class="px-4 py-2 bg-gray-200 rounded-lg">Batal</button>
            <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-lg">Ya, Hapus</button>
        </form>
    </div>
</div>

<script>
    function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

    function openEditModal(studentData) {
        const student = JSON.parse(studentData);
        document.getElementById('edit-form').action = '/master-siswa/edit/' + student.id;
        document.getElementById('edit-student-id').value = student.id;
        document.getElementById('edit-student-name').value = student.name;
        document.getElementById('edit-student-class').value = student.class;
        document.getElementById('edit-student-email').value = student.email;
        openModal('edit-student-modal');
    }

    function openDeleteModal(id) {
        document.getElementById('delete-form').action = '/master-siswa/delete/' + id;
        openModal('delete-confirmation-modal');
    }
</script>

<%- include('../partials/footer') %>
